From ae7a3aabf99d2687ee42aac91bbc578a2ef5bf33 Mon Sep 17 00:00:00 2001
From: void-alive <sja9284@gmail.com>
Date: Tue, 18 Feb 2025 11:59:21 +0900
Subject: [PATCH] =?UTF-8?q?=EB=8C=93=EA=B8=80=20=EC=93=B0=EA=B8=B0=20?=
 =?UTF-8?q?=EA=B8=B0=EB=8A=A5=20=EA=B5=AC=ED=98=84=20=EC=99=84=EB=A3=8C?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../controller/ReplyController.java           | 15 +++-
 .../repository/ReplyRepository.java           | 12 +++
 .../e2teamproject/service/ReplyService.java   |  2 +
 .../service/ReplyServiceImpl.java             |  5 ++
 .../templates/board/crewDetailPage.html       | 79 +++++++++++++------
 5 files changed, 86 insertions(+), 27 deletions(-)

diff --git a/src/main/java/bitc/fullstack503/e2teamproject/controller/ReplyController.java b/src/main/java/bitc/fullstack503/e2teamproject/controller/ReplyController.java
index 745f6e3..e249ad8 100644
--- a/src/main/java/bitc/fullstack503/e2teamproject/controller/ReplyController.java
+++ b/src/main/java/bitc/fullstack503/e2teamproject/controller/ReplyController.java
@@ -3,8 +3,11 @@ package bitc.fullstack503.e2teamproject.controller;
 import bitc.fullstack503.e2teamproject.service.ReplyService;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Controller;
-import org.springframework.web.bind.annotation.RequestMapping;
+import org.springframework.web.bind.annotation.*;
 
+import java.nio.file.Path;
+
+@RestController
 @Controller
 @RequestMapping("/reply")
 public class ReplyController {
@@ -12,8 +15,12 @@ public class ReplyController {
   @Autowired
   private ReplyService replyService;
 
-  @RequestMapping("/")
-  public String reply() {
-    return "reply";
+  @ResponseBody
+  @PostMapping("/write/{crewBoardIdx}/{replyWriteComment}")
+  public void replyWrite(@PathVariable("crewBoardIdx") int crewBoardIdx,
+                         @PathVariable("replyWriteComment") String replyWriteComment) {
+    System.out.println(crewBoardIdx);
+    System.out.println(replyWriteComment);
+    replyService.writeReply(crewBoardIdx, replyWriteComment);
   }
 }
diff --git a/src/main/java/bitc/fullstack503/e2teamproject/repository/ReplyRepository.java b/src/main/java/bitc/fullstack503/e2teamproject/repository/ReplyRepository.java
index 262896e..a0fdc5b 100644
--- a/src/main/java/bitc/fullstack503/e2teamproject/repository/ReplyRepository.java
+++ b/src/main/java/bitc/fullstack503/e2teamproject/repository/ReplyRepository.java
@@ -2,6 +2,18 @@ package bitc.fullstack503.e2teamproject.repository;
 
 import bitc.fullstack503.e2teamproject.entity.ReplyEntity;
 import org.springframework.data.jpa.repository.JpaRepository;
+import org.springframework.data.jpa.repository.Modifying;
+import org.springframework.data.jpa.repository.Query;
+import org.springframework.transaction.annotation.Transactional;
+import org.springframework.web.bind.annotation.RequestParam;
 
 public interface ReplyRepository extends JpaRepository<ReplyEntity, Integer> {
+
+  //  댓글 쓰기
+  @Modifying
+  @Transactional
+  @Query(value = "insert into reply (reply_board_idx, reply_user_idx, comment)" +
+          "values (:crewBoardIdx, 2, :replyWriteComment)", nativeQuery = true)
+  void writeReply(@RequestParam("crewBoardIdx") int crewBoardIdx,
+                  @RequestParam("replyWriteComment") String replyWriteComment);
 }
diff --git a/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyService.java b/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyService.java
index 7e88a05..124e2bf 100644
--- a/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyService.java
+++ b/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyService.java
@@ -1,4 +1,6 @@
 package bitc.fullstack503.e2teamproject.service;
 
 public interface ReplyService {
+//  댓글 쓰기
+  void writeReply(int crewBoardIdx, String replyWriteComment);
 }
diff --git a/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyServiceImpl.java b/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyServiceImpl.java
index ec0dcb3..b71cf27 100644
--- a/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyServiceImpl.java
+++ b/src/main/java/bitc/fullstack503/e2teamproject/service/ReplyServiceImpl.java
@@ -9,4 +9,9 @@ public class ReplyServiceImpl implements ReplyService {
 
   @Autowired
   private ReplyRepository replyRepository;
+
+  @Override
+  public void writeReply(int crewBoardIdx, String replyWriteComment){
+    replyRepository.writeReply(crewBoardIdx, replyWriteComment);
+  }
 }
diff --git a/src/main/resources/templates/board/crewDetailPage.html b/src/main/resources/templates/board/crewDetailPage.html
index f12979f..dc2d6f0 100644
--- a/src/main/resources/templates/board/crewDetailPage.html
+++ b/src/main/resources/templates/board/crewDetailPage.html
@@ -12,19 +12,42 @@
           crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
   <script>
-    $(document).ready(function(){
-        $("#btn-list").on("click",function(){
-            history.back();
-        });
-    });
+      $(document).ready(function () {
+          const crewBoardIdx = $(".crewBoardIdx").val();
+          console.log(crewBoardIdx);
+
+          $("#btn-list").on("click", function () {
+              history.back();
+          });
+          $("#btn-write").on("click", function () {
+              location.href = "/crew/write";
+          });
+          $("#replyWriteButton").on("click", function () {
+              const replyWriteComment = $("#replyWriteComment").val();
+              console.log(replyWriteComment);
+
+              $.ajax({
+                  url: `/reply/write/${crewBoardIdx}/${replyWriteComment}`,
+                  type: 'post',
+                  data: {"crewBoardIdx": crewBoardIdx, "replyWriteComment": replyWriteComment},
+                  // success: function () {
+                  //     alert("공지 등록 완료");
+                  //     location.reload();
+                  // },
+                  // error: function () {
+                  //     alert("공지 등록 완료");
+                  // }
+              });
+          });
+      });
   </script>
 </head>
 <body>
 <div th:replace="~{/layout/header :: projectheader}"></div>
 
 <main class="container container-sm mt-5" style="width: 800px;">
+  <!--인원모집 상세보기-->
   <section>
-
     <form id="frm" action="#" method="post">
       <input type="hidden" id="method" name="_method">
 
@@ -35,30 +58,30 @@
       <div class="mt-4">
         <div class="container-sm d-flex justify-content-between"
              style="border-radius: 5px 5px 0 0; border: solid 0.4px lightgray; height: 40px; align-items: center;">
+          <input type="hidden" th:value="${crew.board_idx}" class="crewBoardIdx">
           <div class="col-sm-8">제목
-            <input type="text" style="border-style: none; width: 450px;" readonly
-            th:value="${crew.title}"></div>
+            <input type="text" style="border-style: none; width: 450px;" readonly th:value="${crew.title}">
+          </div>
           <div class="col-sm-4">작성일
-            <input type="text" style="border-style: none; width: 180px;" readonly
-            th:value="${crew.createDate}"></div>
+            <input type="text" style="border-style: none; width: 180px;" readonly th:value="${crew.createDate}">
+          </div>
         </div>
         <div class="container-sm d-flex justify-content-between"
              style="border-radius: 0 0 5px 5px; border: solid 0.4px lightgray; border-top: none; height: 35px; align-items: center;">
           <div class="col-sm-8">작성자
-            <input type="text" style="border-style: none; width: 400px;" readonly
-            th:value="${crew.user.id}"></div>
+            <input type="text" style="border-style: none; width: 400px;" readonly th:value="${crew.user.id}">
+          </div>
           <div class="col-sm-2">조회
-            <input type="text" style="border-style: none; width: 50px;" readonly
-            th:value="${crew.hitCount}"></div>
+            <input type="text" style="border-style: none; width: 50px;" readonly th:value="${crew.hitCount}">
+          </div>
           <div class="col-sm-2">추천
-            <input type="text" style="border-style: none; width: 50px;" readonly
-            th:value="${crew.likeCount}"></div>
+            <input type="text" style="border-style: none; width: 50px;" readonly th:value="${crew.likeCount}"></div>
         </div>
       </div>
 
       <div class=" mt-3 form-floating">
         <textarea class="form-control" name="contents" id="contents" style="height: 200px;" placeholder="내용을 입력하세요."
-                  readonly  th:text="${crew.contents}">
+                  readonly th:text="${crew.contents}">
         </textarea>
         <label for="contents">글 내용</label>
       </div>
@@ -69,21 +92,31 @@
     <button type="button" class="btn" style="background-color: #bee5eb;" id="btn-write">글쓰기</button>
   </div>
 
+  <!--  댓글-->
   <div class="mt-4">
     <div>
-      <div><i class="fa-regular fa-comment"></i> 댓글</div>
+      <div>
+        <i class="fa-regular fa-comment"></i> 댓글
+      </div>
       <div class="mt-3" style="border: 0.4px solid lightgray; border-radius: 5px;">
-        <div style="padding: 10px 10px 0 10px;"><span style="font-weight: bold;">ID </span><span
-          style="font-size: small"> 작성일</span></div>
+        <div style="padding: 10px 10px 0 10px;">
+          <span style="font-weight: bold;">ID </span>
+          <span style="font-size: small"> 작성일</span>
+        </div>
         <div class="mt-2" style="padding: 0 10px 10px 10px;">review 내용</div>
       </div>
     </div>
-    <div class="d-flex justify-content-between mt-5" style="background-color: #f5f5f5; border-style: none; border-radius: 5px; padding: 10px;">
+    <div class="d-flex justify-content-between mt-5"
+         style="background-color: #f5f5f5; border-style: none; border-radius: 5px; padding: 10px;">
       <div class="col-sm-10 d-flex justify-content-center">
-        <textarea style="width: 628.33px; height: 66px; border-radius: 5px; border-style: none; padding: 0;"></textarea>
+        <textarea style="width: 628.33px; height: 66px; border-radius: 5px; border-style: none; padding: 0;"
+                  class="replyWriteComment" id="replyWriteComment" name="replyWriteComment"></textarea>
       </div>
       <div class="col-sm-2 d-flex justify-content-center">
-        <button type="button" style="border-style: none; border-radius: 5px; background-color: white; width: 77px; height: 70px;">등록</button>
+        <button type="button"
+                style="border-style: none; border-radius: 5px; background-color: white; width: 77px; height: 70px;"
+                class="replyWriteButton" id="replyWriteButton">등록
+        </button>
       </div>
     </div>
   </div>
-- 
2.47.0.windows.2

